<Window x:Class="Annotater.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vlc="clr-namespace:LibVLCSharp.WPF;assembly=LibVLCSharp.WPF"
        Title="Video Annotater"
        MinWidth="800" MinHeight="500"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Background="#1E1E2E"
        Closing="Window_Closing"
        KeyDown="Window_KeyDown">

    <Window.Resources>
        <!-- Win11-style button -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#313244"/>
            <Setter Property="Foreground" Value="#CDD6F4"/>
            <Setter Property="FontFamily" Value="Segoe UI Variable, Segoe UI"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#45475A"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#585B70"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Accent button (for BEGIN/END) -->
        <Style x:Key="AccentButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#89B4FA"/>
            <Setter Property="Foreground" Value="#1E1E2E"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#B4D0FB"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#74C7EC"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Speed button -->
        <Style x:Key="SpeedButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="MinWidth" Value="40"/>
        </Style>

        <!-- Active speed button -->
        <Style x:Key="SpeedButtonActive" TargetType="Button" BasedOn="{StaticResource SpeedButton}">
            <Setter Property="Background" Value="#A6E3A1"/>
            <Setter Property="Foreground" Value="#1E1E2E"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ListBox style -->
        <Style TargetType="ListBox">
            <Setter Property="Background" Value="#181825"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontFamily" Value="Segoe UI Variable, Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#CDD6F4"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- IN/OUT input overlay -->
        <Border x:Name="InOutOverlay" Grid.RowSpan="4"
                Background="#CC000000" Visibility="Collapsed"
                Panel.ZIndex="100">
            <Border Background="#313244" CornerRadius="12" Padding="24"
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    MinWidth="320">
                <StackPanel>
                    <TextBlock Text="Введите значения IN / OUT"
                               Foreground="#CDD6F4" FontSize="16"
                               FontFamily="Segoe UI Variable, Segoe UI"
                               FontWeight="SemiBold" Margin="0,0,0,16"
                               HorizontalAlignment="Center"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="IN:"
                                   Foreground="#A6E3A1" FontSize="14"
                                   FontFamily="Segoe UI Variable, Segoe UI"
                                   FontWeight="SemiBold" VerticalAlignment="Center"
                                   Margin="0,0,12,8"/>
                        <TextBox x:Name="TxtInValue" Grid.Row="0" Grid.Column="1"
                                 FontSize="14" FontFamily="Segoe UI Variable, Segoe UI"
                                 Background="#45475A" Foreground="#CDD6F4"
                                 BorderThickness="0" Padding="8,6"
                                 Margin="0,0,0,8"
                                 PreviewTextInput="IntTextBox_PreviewTextInput"/>
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="OUT:"
                                   Foreground="#F38BA8" FontSize="14"
                                   FontFamily="Segoe UI Variable, Segoe UI"
                                   FontWeight="SemiBold" VerticalAlignment="Center"
                                   Margin="0,0,12,0"/>
                        <TextBox x:Name="TxtOutValue" Grid.Row="1" Grid.Column="1"
                                 FontSize="14" FontFamily="Segoe UI Variable, Segoe UI"
                                 Background="#45475A" Foreground="#CDD6F4"
                                 BorderThickness="0" Padding="8,6"
                                 PreviewTextInput="IntTextBox_PreviewTextInput"/>
                    </Grid>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
                        <Button Content="ОК" Style="{StaticResource AccentButton}"
                                Click="InOutOk_Click" MinWidth="80"/>
                        <Button Content="Отмена" Style="{StaticResource ModernButton}"
                                Click="InOutCancel_Click" MinWidth="80" Margin="8,0,0,0"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Border>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#181825" Foreground="#CDD6F4"
              FontFamily="Segoe UI Variable, Segoe UI" FontSize="13">
            <MenuItem Header="_File" Foreground="#CDD6F4">
                <MenuItem Header="_Open Folder..." Click="OpenFolder_Click"
                          InputGestureText="Ctrl+O" Foreground="#1E1E2E"/>
            </MenuItem>
        </Menu>

        <!-- Main content: Video + File list -->
        <Grid Grid.Row="1" Margin="8,4,8,4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="4*"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="*" MinWidth="180"/>
            </Grid.ColumnDefinitions>

            <!-- Video player -->
            <Grid Grid.Column="0">
                <Border Background="#11111B" CornerRadius="8"/>
                <vlc:VideoView x:Name="VideoView" Visibility="Collapsed"/>
                <TextBlock x:Name="NoVideoLabel"
                           Text="Откройте папку для начала работы"
                           Foreground="#6C7086"
                           FontSize="18"
                           FontFamily="Segoe UI Variable, Segoe UI"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
            </Grid>

            <!-- File list -->
            <Border Grid.Column="2" Background="#181825" CornerRadius="8" Padding="4">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Text="Видеофайлы"
                               Foreground="#A6ADC8" FontSize="12"
                               FontFamily="Segoe UI Variable, Segoe UI"
                               FontWeight="SemiBold"
                               Margin="8,4,0,4"/>
                    <ListBox x:Name="FileListBox" Grid.Row="1"
                             SelectionChanged="FileListBox_SelectionChanged"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             VirtualizingStackPanel.IsVirtualizing="True"
                             VirtualizingStackPanel.VirtualizationMode="Recycling">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}" Padding="4,2"
                                           TextTrimming="CharacterEllipsis">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#CDD6F4"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsProcessed}" Value="True">
                                                    <Setter Property="Foreground" Value="#6C7086"/>
                                                    <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsCurrent}" Value="True">
                                                    <Setter Property="Foreground" Value="#89B4FA"/>
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                    <Setter Property="TextDecorations" Value="{x:Null}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>
        </Grid>

        <!-- Seek slider -->
        <Grid Grid.Row="2" Margin="8,2,8,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock x:Name="LblCurrentTime" Grid.Column="0" Text="00:00:00"
                       Foreground="#A6ADC8" FontSize="11" VerticalAlignment="Center"
                       FontFamily="Segoe UI Variable, Segoe UI" Margin="4,0,8,0"/>
            <Slider x:Name="SeekSlider" Grid.Column="1"
                    Minimum="0" Maximum="100" Value="0"
                    VerticalAlignment="Center"
                    PreviewMouseLeftButtonDown="SeekSlider_PreviewMouseDown"
                    PreviewMouseLeftButtonUp="SeekSlider_PreviewMouseUp"
                    ValueChanged="SeekSlider_ValueChanged"
                    IsEnabled="False"/>
            <TextBlock x:Name="LblDuration" Grid.Column="2" Text="00:00:00"
                       Foreground="#A6ADC8" FontSize="11" VerticalAlignment="Center"
                       FontFamily="Segoe UI Variable, Segoe UI" Margin="8,0,4,0"/>
        </Grid>

        <!-- Bottom button bar -->
        <Border Grid.Row="3" Background="#181825" CornerRadius="8,8,0,0" Padding="8,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Action buttons -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button x:Name="BtnStart" Content="START (S)" Style="{StaticResource ModernButton}" Click="Start_Click"/>
                    <Button x:Name="BtnBegin" Content="BEGIN (Q)" Style="{StaticResource AccentButton}" Click="Begin_Click" IsEnabled="False"/>
                    <Button x:Name="BtnEnd" Content="END (W)" Style="{StaticResource AccentButton}" Click="End_Click" IsEnabled="False"/>
                    <Button x:Name="BtnNext" Content="NEXT (N)" Style="{StaticResource ModernButton}" Click="Next_Click" IsEnabled="False"/>
                </StackPanel>

                <!-- Speed buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="16,0,0,0">
                    <Button x:Name="BtnSpeed1" Content="1x" Style="{StaticResource SpeedButtonActive}" Click="Speed1_Click"/>
                    <Button x:Name="BtnSpeed2" Content="2x" Style="{StaticResource SpeedButton}" Click="Speed2_Click"/>
                    <Button x:Name="BtnSpeed3" Content="3x" Style="{StaticResource SpeedButton}" Click="Speed3_Click"/>
                    <Button x:Name="BtnSpeed4" Content="4x" Style="{StaticResource SpeedButton}" Click="Speed4_Click"/>
                    <Button x:Name="BtnSpeed8" Content="8x" Style="{StaticResource SpeedButton}" Click="Speed8_Click"/>
                </StackPanel>

                <!-- Current position -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="16,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="Pos: " Foreground="#6C7086" FontSize="12"
                               FontFamily="Segoe UI Variable, Segoe UI" VerticalAlignment="Center"/>
                    <TextBlock x:Name="LblPosition" Text="--:--:--" Foreground="#CDD6F4" FontSize="12"
                               FontFamily="Segoe UI Variable, Segoe UI" VerticalAlignment="Center" MinWidth="55"/>
                </StackPanel>

                <!-- Time labels -->
                <StackPanel Grid.Column="5" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,8,0">
                    <Border Background="#313244" CornerRadius="4" Padding="8,4" Margin="4,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Time1: " Foreground="#A6ADC8" FontSize="12"
                                       FontFamily="Segoe UI Variable, Segoe UI"/>
                            <TextBlock x:Name="LblTime1" Text="--:--:--" Foreground="#A6E3A1" FontSize="12"
                                       FontFamily="Segoe UI Variable, Segoe UI" FontWeight="SemiBold" MinWidth="55"/>
                        </StackPanel>
                    </Border>
                    <Border Background="#313244" CornerRadius="4" Padding="8,4" Margin="4,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Time2: " Foreground="#A6ADC8" FontSize="12"
                                       FontFamily="Segoe UI Variable, Segoe UI"/>
                            <TextBlock x:Name="LblTime2" Text="--:--:--" Foreground="#F38BA8" FontSize="12"
                                       FontFamily="Segoe UI Variable, Segoe UI" FontWeight="SemiBold" MinWidth="55"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- File counter -->
                <TextBlock Grid.Column="6" x:Name="LblFileCount" Text=""
                           Foreground="#6C7086" FontSize="12"
                           FontFamily="Segoe UI Variable, Segoe UI"
                           VerticalAlignment="Center" Margin="4,0,4,0"/>
            </Grid>
        </Border>
    </Grid>
</Window>
